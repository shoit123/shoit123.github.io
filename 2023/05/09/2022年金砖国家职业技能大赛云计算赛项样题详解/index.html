<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>2022年金砖国家职业技能大赛云计算赛项样题详解 | Hexo</title><meta name="author" content="John Doe"><meta name="copyright" content="John Doe"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="2022 年金砖国家职业技能大赛云计算_赛项样题A 场次题目：OpenStack 平台部署与运维任务 1 私有云平台环境初始化（5 分）1.初始化操作系统​			使用提供的用户名密码，登录竞赛云平台。根据表 1 中的 IP 地址规划，设 置各服务器节点的 IP 地址，确保网络正常通信，设置控制节点主机名为 Contro ller，计算节点主机名为 Compute，并修改 hosts 文件将 IP">
<meta property="og:type" content="article">
<meta property="og:title" content="2022年金砖国家职业技能大赛云计算赛项样题详解">
<meta property="og:url" content="http://example.com/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="2022 年金砖国家职业技能大赛云计算_赛项样题A 场次题目：OpenStack 平台部署与运维任务 1 私有云平台环境初始化（5 分）1.初始化操作系统​			使用提供的用户名密码，登录竞赛云平台。根据表 1 中的 IP 地址规划，设 置各服务器节点的 IP 地址，确保网络正常通信，设置控制节点主机名为 Contro ller，计算节点主机名为 Compute，并修改 hosts 文件将 IP">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://bu.dusays.com/2022/05/26/628fa0426213d.png">
<meta property="article:published_time" content="2023-05-09T08:01:58.000Z">
<meta property="article:modified_time" content="2023-05-09T08:04:32.860Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="openstack">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://bu.dusays.com/2022/05/26/628fa0426213d.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: John Doe","link":"Link: ","source":"Source: Hexo","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '2022年金砖国家职业技能大赛云计算赛项样题详解',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-09 16:04:32'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/mycss.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/touxiang.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://bu.dusays.com/2022/05/26/628fa0426213d.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Hexo"><span class="site-name">Hexo</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">2022年金砖国家职业技能大赛云计算赛项样题详解</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-05-09T08:01:58.000Z" title="Created 2023-05-09 16:01:58">2023-05-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-05-09T08:04:32.860Z" title="Updated 2023-05-09 16:04:32">2023-05-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97/">云计算</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="2022年金砖国家职业技能大赛云计算赛项样题详解"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="2022-年金砖国家职业技能大赛云计算-赛项样题"><a href="#2022-年金砖国家职业技能大赛云计算-赛项样题" class="headerlink" title="2022 年金砖国家职业技能大赛云计算_赛项样题"></a>2022 年金砖国家职业技能大赛云计算_赛项样题</h1><h2 id="A-场次题目：OpenStack-平台部署与运维"><a href="#A-场次题目：OpenStack-平台部署与运维" class="headerlink" title="A 场次题目：OpenStack 平台部署与运维"></a>A 场次题目：OpenStack 平台部署与运维</h2><h4 id="任务-1-私有云平台环境初始化（5-分）"><a href="#任务-1-私有云平台环境初始化（5-分）" class="headerlink" title="任务 1 私有云平台环境初始化（5 分）"></a>任务 1 私有云平台环境初始化（5 分）</h4><h5 id="1-初始化操作系统"><a href="#1-初始化操作系统" class="headerlink" title="1.初始化操作系统"></a>1.初始化操作系统</h5><p>​			使用提供的用户名密码，登录竞赛云平台。根据表 1 中的 IP 地址规划，设 置各服务器节点的 IP 地址，确保网络正常通信，设置控制节点主机名为 Contro ller，计算节点主机名为 Compute，并修改 hosts 文件将 IP 地址映射为主机名， 关闭防火墙并设置为开机不启动，设置 SELinux 为 Permissive 模式并设置永久关闭。请查看控制节点和计算节点主机名，使用命令查看 SELinux 状态，使用 h ead 命令、tail 命令和 cut 命令提取出永久关闭 SELinux 的关键信息。 </p>
<p>​			将以上命令及返回结果提交到答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname controller</span><br><span class="line">hostnamectl set-hostname compute</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">192.168.10.10 controller</span><br><span class="line">192.168.10.20 compute</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span><br><span class="line">setenforce 1 &amp;&amp; sed -i &#x27;s/enforcing/disabled/g&#x27; /etc/selinux/config</span><br><span class="line"></span><br><span class="line">head /etc/selinux/config  | grep =disabled</span><br><span class="line">tail /etc/selinux/config  | grep =disabled</span><br><span class="line">cut -d &#x27; &#x27; -f 1 /etc/selinux/config </span><br></pre></td></tr></table></figure>

<h5 id="2-挂载安装光盘镜像"><a href="#2-挂载安装光盘镜像" class="headerlink" title="2.挂载安装光盘镜像"></a>2.挂载安装光盘镜像</h5><p>​			将提供的 CentOS-7-x86_64-DVD-1804.iso 和 chinaskills_cloud_iaas.iso 光盘镜像上传到 Controller 节点 &#x2F;root 目录下，然后在 &#x2F;opt 目录下使用一条 命令创建&#x2F;centos 目录和&#x2F;iaas 目录，并将镜像文件 CentOS-7-x86_64-DVD-1804. iso 挂载到 &#x2F;centos 目录下，将镜像文件 chinaskills_cloud_iaas.iso 挂载到 &#x2F;iaas 目录下。 </p>
<p>​			请将以上命令及返回结果返回到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/&#123;centos,iaas&#125;</span><br><span class="line">mount CentOS-7-x86_64-DVD-1804.iso /opt/centos</span><br><span class="line">mount chinaskills_cloud_iaas.iso /opt/iaas</span><br></pre></td></tr></table></figure>

<h5 id="3-搭建文件共享服务器"><a href="#3-搭建文件共享服务器" class="headerlink" title="3.搭建文件共享服务器"></a>3.搭建文件共享服务器</h5><p>​			在 Controller 节点上安装 vsftp 服务器，设置开机自启动</p>
<p>​			请将以上命令 及返回结果提交到答题框。【0.5 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vsftpd</span><br><span class="line">systemctl enable vsftpd</span><br></pre></td></tr></table></figure>

<h5 id="4-设置-yum-源"><a href="#4-设置-yum-源" class="headerlink" title="4.设置 yum 源"></a>4.设置 yum 源</h5><p>​			将 ftp 仓库设置为 &#x2F;opt&#x2F;，为 controller 节点设置本地 yum 源，yum 源文 件名为 local.repo；为 compute 配置 ftp 源，yum 源文件名称为 ftp.repo，其 中 ftp 服务器地址为 controller 节点 IP。 </p>
<p>​			请将两个节点的 yum 源文件内容提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# cat /etc/yum.repos.d/loca.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=file:///opt/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[root@compute ~]# cat /etc/yum.repos.d/ftp.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://controller/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://controller/iaas/iaas-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<h5 id="5-部署时间同步服务器"><a href="#5-部署时间同步服务器" class="headerlink" title="5.部署时间同步服务器"></a>5.部署时间同步服务器</h5><p>​			在 Controller 节点上部署 chrony 服务器，允许其他节点同步时间，启动服 务并设置为开机启动；在 compute 节点上指定 controller 节点为上游 NTP 服务 器，重启服务并设为开机启动。 </p>
<p>​			请在控制节点上使用 chronyc 命令同步控制节点的系统时间。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">yum -y install chronyd</span><br><span class="line"></span><br><span class="line">[root@controller ~]# cat /etc/chrony.conf | grep -v &#x27;^#&#x27;		# 查看开头不是#号的数据</span><br><span class="line">server controller iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line">allow 192.168.10.0/24</span><br><span class="line">local stratum 10</span><br><span class="line"></span><br><span class="line">[root@compute ~]# cat /etc/chrony.conf | grep -v &#x27;^#&#x27;</span><br><span class="line">server controller iburst</span><br><span class="line">driftfile /var/lib/chrony/drift</span><br><span class="line">makestep 1.0 3</span><br><span class="line">rtcsync</span><br><span class="line">logdir /var/log/chrony</span><br><span class="line"></span><br><span class="line">systemctl start chronyd &amp;&amp; systemctl enable chronyd</span><br><span class="line">chronyc sources -v </span><br></pre></td></tr></table></figure>

<h4 id="任务-2-OpenStack-搭建任务（10-分）"><a href="#任务-2-OpenStack-搭建任务（10-分）" class="headerlink" title="任务 2 OpenStack 搭建任务（10 分）"></a>任务 2 OpenStack 搭建任务（10 分）</h4><h5 id="1-修改变量文件"><a href="#1-修改变量文件" class="headerlink" title="1.修改变量文件"></a>1.修改变量文件</h5><p>​			在控制节点和计算节点上分别安装 iaas-xiandian 软件包，修改配置脚本文 件中基本变量（配置脚本文件为&#x2F;etc&#x2F;xiandian&#x2F;openrc.sh）。修改完成后使用 命令生效该变量文件，然后执行 echo $INTERFACE_IP 命令。 </p>
<p>​			请将命令和返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# source /etc/xiandian/openrc.sh </span><br><span class="line">[root@controller ~]# echo $INTERFACE_IP             </span><br><span class="line">192.168.10.10</span><br></pre></td></tr></table></figure>

<h5 id="2-搭建数据库组件"><a href="#2-搭建数据库组件" class="headerlink" title="2.搭建数据库组件"></a>2.搭建数据库组件</h5><p>​			使用提供的脚本框架 iaas-install-mysql.sh 填充脚本，在 controller 节点上安装 mariadb、mencached、rabbitmq 等服务并完成相关配置。完成后修 改配置文件将 mencached 最大连接数修改为 2048。</p>
<p>​			 请将修改后的配置文件提交到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/1024/2048/g&#x27; /etc/sysconfig/memcached			</span><br><span class="line">systemctl restart memcached</span><br></pre></td></tr></table></figure>

<h5 id="3-搭建认证服务组件"><a href="#3-搭建认证服务组件" class="headerlink" title="3.搭建认证服务组件"></a>3.搭建认证服务组件</h5><p>​			使用提供的脚本框架 iaas-install-keystone.sh 填充脚本，在 controlle r 节点上安装 keystone 服务并完成相关配置。完成后使用 openstack 命令请求 一个 token。 </p>
<p>​			请将以上命令和返回结果提交到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack token issue  </span><br></pre></td></tr></table></figure>

<h5 id="4-搭建镜像服务组件"><a href="#4-搭建镜像服务组件" class="headerlink" title="4.搭建镜像服务组件"></a>4.搭建镜像服务组件</h5><p>​			使用提供的脚本框架 iaas-install-glance.sh 填充脚本，在 controller 节点上安装 glance 服务并完成相关配置。完成后请将 cirros-0.3.4-x86_64-d isk.img 上传到控制节点的 &#x2F;root 目录下，然后使用 openstack 命令将该镜像 上传到 openstack 平台镜像命名为 cirros。 			请将镜像上传的操作命令和返回结果提交到答题框。【1 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack image create --disk-format qcow2 --container-format bare --file /root/cirros-0.3.4-x86_64-disk.img cirros </span><br></pre></td></tr></table></figure>

<h5 id="5-搭建计算服务组件"><a href="#5-搭建计算服务组件" class="headerlink" title="5.搭建计算服务组件"></a>5.搭建计算服务组件</h5><p>​			使用提供的脚本框架 iaas-install-nova-controller.sh 和 iaas-install -nova-compute.sh 填充脚本，在 controller 和 compute 节点上安装 nova 服 务并完成配置。完成后请将控制节点的计算资源也加入集群。然后使用 openstack 命令列出能提供计算资源的节点。 </p>
<p>​			将列出计算资源的命令和返回结果提交到答题框。【1.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s/192.168.10.20/192.168.10.10/g&#x27; /etc/xiandian/openrc.sh </span><br><span class="line">sed -i &#x27;s/compute/controller/g&#x27; /etc/xiandian/openrc.sh  </span><br><span class="line">iaas-install-nova-compute.sh</span><br><span class="line">openstack compute service list</span><br></pre></td></tr></table></figure>

<h5 id="6-搭建网络组件并初始化网络"><a href="#6-搭建网络组件并初始化网络" class="headerlink" title="6.搭建网络组件并初始化网络"></a>6.搭建网络组件并初始化网络</h5><p>​			使用提供的脚本框架 iaas-install-neutron-controller.sh 和 iaas-install-neutron-compute.sh，填充脚本，在 controller 和 compute 节点上安装 neutron 服务并完成配置。创建云主机外部网络ext-net，子网为ext-subnet， 云主机浮动 IP 可用网段为 172.18.x.100<del>172.18.x.200，网关为172.18.x.1。 创建云主机内部网络int-net1，子网为int-subnet1，云主机子网 IP 可用网段 为 10.0.0.100</del>10.0.0.200，网关为10.0.0.1；创建云主机内部网络int-net2， 子网为 int-subnet2，云主机子网 IP 可用网段为10.0.1.100 ~ 10.0.1.200， 网关为 10.0.1.1。添加名为 ext-router 的路由器，添加网关在 ext-net 网络， 添加内部端口到 int-net1 网络，完成内部网络 int-net1 和外部网络的连通。 </p>
<p>​			请使用 openstack 命令完成以下任务，完成后将命令和返回结果提交到答题 框。【4 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">内网</span></span><br><span class="line">openstack network create int-net1</span><br><span class="line">openstack subnet create --network int-net1 --subnet-range 10.0.0.0/24 --allocation-pool start=10.0.0.100,end=10.0.0.200 --gateway=10.0.0.1 int-subnet1</span><br><span class="line">openstack network create int-net2</span><br><span class="line">openstack subnet create --network int-net2 --subnet-range 10.0.1.0/24 --allocation-pool start=10.0.1.100,end=10.0.1.200 --gateway=10.0.1.1 int-subnet2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">外网</span></span><br><span class="line">openstack network create --external --provider-network-type flat --provider-physical-network provider ext-net</span><br><span class="line">openstack subnet create --network ext-net --subnet-range 172.16.10.0/24 --allocation-pool start=172.16.10.100,end=172.16.10.200 --gateway 172.16.10.1 ext-subnet</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">路由</span></span><br><span class="line">openstack router create ext-router</span><br><span class="line">openstack router add subnet ext-router int-subnet1</span><br><span class="line">openstack router set --external-gateway ext-net ext-router</span><br></pre></td></tr></table></figure>

<h5 id="7-搭建图形化界面"><a href="#7-搭建图形化界面" class="headerlink" title="7.搭建图形化界面"></a>7.搭建图形化界面</h5><p>​			使用提供的脚本框架 iaas-install-dashboard.sh，填充脚本，在 control ler 节点上安装 dashboard 服务并完成相关配置。 </p>
<p>​			请使用 curl 指令获取 dashboard 首页信息，将获取到的首页信息提交到答 题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost/dashboard</span><br></pre></td></tr></table></figure>

<h4 id="任务-3-OpenStack-运维任务（15-分）"><a href="#任务-3-OpenStack-运维任务（15-分）" class="headerlink" title="任务 3 OpenStack 运维任务（15 分）"></a>任务 3 OpenStack 运维任务（15 分）</h4><h5 id="1-用户管理"><a href="#1-用户管理" class="headerlink" title="1.用户管理"></a>1.用户管理</h5><p>​			在 keystone 中创建用户 testuser，密码为 password。创建好之后，使用命令修改 testuser 密码为 000000，并查看 testuser 的详细信息。添加将该用户添加到 admin 项目并赋予普通用户权限，完成后测试登录。 </p>
<p>​			使用 testuser 用登录系统完成后截图并提交到答题框。【1 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack user create --password password --domain demo testuser</span><br><span class="line">openstack user set --password 000000 testuser</span><br><span class="line">openstack role add --project admin --user testuser user</span><br></pre></td></tr></table></figure>

<h5 id="2-服务查询"><a href="#2-服务查询" class="headerlink" title="2.服务查询"></a>2.服务查询</h5><p>​			使用命令列出服务目录和端点，查看 glance 服务的端点。</p>
<p>​			将以上命令和返 回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">openstack service list</span><br><span class="line">openstack endpoint list | grep glance</span><br></pre></td></tr></table></figure>

<h5 id="3-镜像管理"><a href="#3-镜像管理" class="headerlink" title="3.镜像管理"></a>3.镜像管理</h5><p>​			登录 controller 节点，使用 glance 相关命令，上传镜像，源使用 CentO S_6.5_x86_64_XD.qcow2，名字为 testone，然后使用 openstack 命令修改这个 镜像名改为 examimage，然后给这个镜像打一个标签，标签名字为 lastone 改 完后使用 openstack 命令查看镜像列表。 </p>
<p>​			将以上命令和返回结果提交到答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">glance image-create --disk-format qcow2 --container-format bare --name testone --progress &lt; /opt/iaas/images/CentOS_7.5_x86_64_XD.qcow2 </span><br><span class="line">openstack image set --name examimage --tag lastone testone </span><br><span class="line">openstack image list</span><br></pre></td></tr></table></figure>

<h5 id="4-后端配置文件管理"><a href="#4-后端配置文件管理" class="headerlink" title="4.后端配置文件管理"></a>4.后端配置文件管理</h5><p>​			进入到glance 后端存储目录中，使用 qemu 命令查看任意的一个镜像信息。 使用 du 命令查看 nova 主配置文件大小。 </p>
<p>​			将以上命令和返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /var/lib/glance		# 后端存储目录</span><br><span class="line">qemu-img info images/83720f4b-4b11-4218-bf97-0b3880676383</span><br><span class="line">du -h nova.conf</span><br></pre></td></tr></table></figure>

<h5 id="5-存储服务管理"><a href="#5-存储服务管理" class="headerlink" title="5.存储服务管理"></a>5.存储服务管理</h5><p>​			创建一个卷类型，然后创建一块带这个卷类型标识的云硬盘，查询该云硬盘 的详细信息。将该云硬盘挂载到虚拟机中，将该云硬盘格式化为 xfs。创建一个 文件文件名为工位号内容为工位号，然后将该云硬盘卸载，使用 openstack 命令 将该云硬盘修改为只读状态，再次挂载后查看是否存在原始文件，然后再次向该 云硬盘中创建一个文件，文件名为工位号_02。 </p>
<p>​			将返回结果及解题过程提交到答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">openstack volume type create lvm</span><br><span class="line">openstack volume create --type lvm --size 20 test</span><br><span class="line">openstack volume show test </span><br><span class="line"></span><br><span class="line">openstack server add volume test test</span><br><span class="line">mkfs.xfs /deb/vdb</span><br><span class="line">echo 2222 &gt; 2222.txt</span><br><span class="line">openstack server remove volume test test</span><br><span class="line">openstack volume set --read-only test</span><br><span class="line">openstack server add volume test test</span><br></pre></td></tr></table></figure>

<h5 id="6-存储服务管理"><a href="#6-存储服务管理" class="headerlink" title="6.存储服务管理"></a>6.存储服务管理</h5><p>​			使用命令创建一个 5GB 的云硬盘，名称为 disk-2，将云硬盘挂载到云虚拟 机内，然后格式化为 ext4，挂载到虚拟机的 &#x2F;mnt&#x2F; 目录下，使用 df -h 将命令 和返回信息提交到答题框。将该云硬盘使用命令卸载，使用命令将该云硬盘扩容 到 10GB，使用命令将云硬盘挂载到云主机上，将命令及返回信息提交到答题框。 进入云主机使用命令扩容文件系统，扩容后再次挂载到 &#x2F;mnt&#x2F;。 </p>
<p>​			使用 df -hT 命令并将命令和返回信息提交到答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">openstack volume create --size 5 disk-2</span><br><span class="line">openstack server add volume test disk-2</span><br><span class="line"></span><br><span class="line">mkfs.ext4 /dev/vdb</span><br><span class="line">df -h 显示4.8G</span><br><span class="line">openstack server remove volume test disk-2</span><br><span class="line"></span><br><span class="line">openstack volume set --size 15 disk-2</span><br><span class="line">openstack server add volume test disk-2</span><br><span class="line">.......</span><br></pre></td></tr></table></figure>

<p>7.对象存储管理 </p>
<p>​			使用 swift 相关命令，创建一个容器，然后往这个容器中上传一个文件（文件可以自行创建），上传完毕后，使用命令查看容器。 			将以上命令和返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">swift post test</span><br><span class="line">swift upload test logininfo.txt </span><br><span class="line">swift list test</span><br></pre></td></tr></table></figure>

<h5 id="8-安全组管理"><a href="#8-安全组管理" class="headerlink" title="8.安全组管理"></a>8.安全组管理</h5><p>​			使用命令创建名称为 group_web的安全组该安全组的描述为工位号，为该安全组添加一条规则允许任意 ip 地址访问 web 流量，完成后查看该安全组的详细 信息。 	</p>
<p>​			将以上命令和返回结果提交到答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">openstack security group create group_web --description test-aaa </span><br><span class="line">openstack security group rule create --ingress --protocol 80 group_web </span><br><span class="line">openstack security group show group_web</span><br></pre></td></tr></table></figure>

<h5 id="9-网络管理"><a href="#9-网络管理" class="headerlink" title="9.网络管理"></a>9.网络管理</h5><p>​			使用命令将int-net1网络设置为共享，然后查看int-net1网络的详细信息。</p>
<p>​			将命令和返回信息提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openstack network set --share int-net1</span><br></pre></td></tr></table></figure>

<h5 id="10-网络管理"><a href="#10-网络管理" class="headerlink" title="10.网络管理"></a>10.网络管理</h5><p>​			使用 dashboard 界面使用 centos7.5 镜像创建一台云主机，云主机命名为 t est-01，使用命令查看浮动 IP 地址池，使用命令创建一个浮动 IP，然后将浮动 IP 绑定到云主机上。 </p>
<p>​			将命令和返回信息提交到答题框。【1 分】 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">命令行</span><br><span class="line">openstack server create --image <span class="built_in">test</span> --flavor <span class="built_in">test</span> --network int-net1 test-01</span><br><span class="line">openstack floating ip list</span><br><span class="line">openstack floating ip create --subnet ext-subnet ext-net</span><br><span class="line">openstack server add floating ip test-01 <span class="comment"># 浮动IP地址，自行创建</span></span><br></pre></td></tr></table></figure>

<h5 id="11-虚拟机管理"><a href="#11-虚拟机管理" class="headerlink" title="11.虚拟机管理"></a>11.虚拟机管理</h5><p>​			使用 opentack 命令利用 centos7.5 镜像创建一台云主机，连接 int-net1 网 络，云主机名称为 test-02。创建成功后使用命令查看云主机详细信息，确定该 云主机是处于计算节点还是控制节点。如果云主机处于控制节点上请将其冷迁移 到计算节点，如果如果云主机处于计算节点上请将其冷迁移到控制节点。 </p>
<p>​			本题全部流程请使用命令完成，请将全部命令和结果粘贴到答题框。【3 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">openstack server create --image test --flavor test --network int-net1 test-02</span><br><span class="line">openstack server show test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先关闭云主机，进行下步操作</span></span><br><span class="line">nova stop test-02</span><br><span class="line">scp -r 763822a6-0a28-4461-8e79-1b5d427eb829/ controller://var/lib/nova/instances</span><br><span class="line"></span><br><span class="line">mysql -uroot -p000000				# 进入nova数据库，将需要迁移的镜像的node和host改为controller</span><br><span class="line">use nova;</span><br><span class="line">select * from instances\G;</span><br><span class="line">update instances set node=&#x27;controller&#x27;,host=&#x27;controller&#x27; where id=1;</span><br><span class="line">quit</span><br><span class="line"></span><br><span class="line">nova start test-02</span><br><span class="line">openstack server show test-02</span><br></pre></td></tr></table></figure>

<h2 id="B-场次题目：容器的编排与运维"><a href="#B-场次题目：容器的编排与运维" class="headerlink" title="B 场次题目：容器的编排与运维"></a>B 场次题目：容器的编排与运维</h2><h4 id="任务-1-容器云平台环境初始化（5-分）"><a href="#任务-1-容器云平台环境初始化（5-分）" class="headerlink" title="任务 1 容器云平台环境初始化（5 分）"></a>任务 1 容器云平台环境初始化（5 分）</h4><h5 id="1-容器云平台的初始化-vim"><a href="#1-容器云平台的初始化-vim" class="headerlink" title="1.容器云平台的初始化 vim"></a>1.容器云平台的初始化 vim</h5><p>​			根据表 2 的 IP 地址规划，创建云服务器，镜像使用 CentOS_7.5_x86_64_XD. qcow，确保网络正常通信。按照表 2 置主机名节点并关闭swap，同时永久关闭 selinux 以及防火墙,并修改 hosts 映射。 </p>
<p>​			请将 master 节点 hosts 文件内容提交到答题框。【1 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">192.168.20.10 master</span><br><span class="line">192.168.20.20 node1</span><br><span class="line">192.168.20.30 node2</span><br><span class="line">192.168.20.40 harbor</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sed -i &#x27;s/enforcing/disabled/g&#x27; /etc/selinux/config</span><br><span class="line">swapoff -a</span><br><span class="line">sed -i &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure>

<h5 id="2．Yum-源数据的持久化挂载"><a href="#2．Yum-源数据的持久化挂载" class="headerlink" title="2．Yum 源数据的持久化挂载"></a>2．Yum 源数据的持久化挂载</h5><p>​			将提供的 CentOS-7-x86_64-DVD-1804.iso 和 chinaskills_cloud_paas.iso 光盘镜像上传到 master 节点 &#x2F;root 目录下，然后在 &#x2F;opt 目录下使用命令创建 &#x2F;centos 目录和 &#x2F;paas 目录，并将镜像文件 CentOS-7-x86_64-DVD-1804.iso 挂 载到&#x2F;centos 目录下，将镜像文件 chinaskills_cloud_paas.iso 挂载到 &#x2F;paas 目录下。 </p>
<p>​			请设置永久开机自动挂载，并将设置的永久开机自动挂载的文件内容提交到 答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir /opt/&#123;centos,paas&#125;</span><br><span class="line">mount -o loop CentOS-7-x86_64-DVD-1804.iso /centos</span><br><span class="line">mount -o loop chinaskills_cloud_paas.iso /paas</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/fstab &lt;&lt; EOF</span><br><span class="line">/root/CentOS-7-x86_64-DVD-1804.iso /opt/centos		iso9660 defaults	0 0</span><br><span class="line">/root/chinaskills_cloud_paas.iso /opt/paas		iso9660 defaults	0 0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h5 id="3．Yum-源的编写"><a href="#3．Yum-源的编写" class="headerlink" title="3．Yum 源的编写"></a>3．Yum 源的编写</h5><p>​			为 master 节点设置本地 yum 源，yum 源文件名为 centos.repo，安装 ftp 服 务，将 ftp 仓库设置为 &#x2F;opt&#x2F;，为其他节点配置 ftp 源，yum 源文件名称为 ftp. repo，其中 ftp 服务器地址为 master 节点 IP。 </p>
<p>​			请将其它节点的 yum 源文件内容提交到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat /etc/yum.repos.d/loca.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=file:///opt/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=file:///opt/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[root@node1 ~]# cat /etc/yum.repos.d/ftp.repo </span><br><span class="line">[centos]</span><br><span class="line">name=centos</span><br><span class="line">baseurl=ftp://master/centos</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[iaas]</span><br><span class="line">name=iaas</span><br><span class="line">baseurl=ftp://master/paas/kubernetes-repo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<h5 id="4．设置时间同步服务器"><a href="#4．设置时间同步服务器" class="headerlink" title="4．设置时间同步服务器"></a>4．设置时间同步服务器</h5><p>​				在 master 节点上部署 chrony 服务器，允许其他节点同步时间，启动服务并 设置为开机启动；在其他节点上指定 master 节点为上游 NTP 服务器，重启服务 并设为开机启动。 </p>
<p>​				请在 master 节点上使用 chronyc 命令同步控制节点的系统时间。【1 分】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">步骤同上私有云</span><br></pre></td></tr></table></figure>

<h5 id="5-设置免密登录"><a href="#5-设置免密登录" class="headerlink" title="5.设置免密登录"></a>5.设置免密登录</h5><p>​			为四台服务器设置免密登录，保证 3 台服务器能够互相免密登录。请使用 scp 命令将 master 节点的 hosts 文件发送到所有节点的 &#x2F;etc&#x2F;hosts。</p>
<p>​			将以上所 有命令和返回结果提交到答题框。【1 分】 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen  </span><br><span class="line">ssh-copy-id 主机名</span><br></pre></td></tr></table></figure>

<h4 id="任务-2-Kubernetes-搭建任务（10-分）"><a href="#任务-2-Kubernetes-搭建任务（10-分）" class="headerlink" title="任务 2 Kubernetes 搭建任务（10 分）"></a>任务 2 Kubernetes 搭建任务（10 分）</h4><h5 id="1-安装-docker-应用"><a href="#1-安装-docker-应用" class="headerlink" title="1.安装 docker 应用"></a>1.安装 docker 应用</h5><p>​			在所有节点上安装 dokcer-ce。并在 harbor 节点安装 harbor 仓库，显现正常登录 horbor 仓库，登录密码设置为“test_工位号”。</p>
<p>​			请将登录后截图提交到 答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce</span><br><span class="line">systemctl start docker &amp;&amp; systemctl enable docker</span><br><span class="line">cp docker-compose-linux-x86_64 /usr/local/bin/docker-compose</span><br><span class="line">tar -zxvf harbor-offline-installer-v2.5.3.tgz</span><br><span class="line">cd harbor &amp;&amp; cp harbor.yml.tmpl harbor.yml</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改harbor.yml文件，注释所有https，修改hostname，port</span></span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

<h5 id="2-搭建-horbor-仓库"><a href="#2-搭建-horbor-仓库" class="headerlink" title="2.搭建 horbor 仓库"></a>2.搭建 horbor 仓库</h5><p>​			修改默认 docker 仓库为 horbor 地址，修改 docker 启动引擎为 systemd。 </p>
<p>​			安装完成后执行 docker verison 命令返回结果以及将 daemon.json 文件内容提 交。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor ~]# cat /etc/docker/daemon.json </span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://xubospqn.mirror.aliyuncs.com&quot;],</span><br><span class="line">  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;],</span><br><span class="line">  &quot;insecure-registry&quot;: [&quot;192.168.20.30&quot;]</span><br><span class="line">&#125;</span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br></pre></td></tr></table></figure>

<h5 id="3-安装-docker-compose"><a href="#3-安装-docker-compose" class="headerlink" title="3.安装 docker-compose"></a>3.安装 docker-compose</h5><p>​			在 master 节点上使用 &#x2F;opt&#x2F;paas&#x2F;docker-compose&#x2F;v1.25.5-docker-compo se-Linux-x86_6 下的文件安装 docker-compose。</p>
<p>​			安装完成后执行 docker-compose version 命令，请将程序返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp  /opt/paas/docker-compose/v1.25.5-docker-compo se-Linux-x86_6 /usr/local/bin/docker-compose</span><br><span class="line">docker-compose version</span><br></pre></td></tr></table></figure>

<h5 id="4-上传-docker-镜像"><a href="#4-上传-docker-镜像" class="headerlink" title="4.上传 docker 镜像"></a>4.上传 docker 镜像</h5><p>​			在 master 节点使用 &#x2F;opt&#x2F;paas&#x2F; k8s_image_push.sh 将所有镜像上传至 do cker 仓库。</p>
<p>​			完成后将 Harbor 仓库 library 中镜像列表截图，请将以上截图提交 到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./k8s_image_push.sh</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">期间需要输入harbor仓库地址，用户以及密码</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230315193854132.png" alt="image-20230315193854132"></p>
<h5 id="5-安装-kubeadm-工具"><a href="#5-安装-kubeadm-工具" class="headerlink" title="5.安装 kubeadm 工具"></a>5.安装 kubeadm 工具</h5><p>​			在 master 及 node 节点安装 Kubeadm 工具并设置开机自动启动，安装完成后 使用 rpm 命令配合 grep 查看 Kubeadm 工具是否正确安装。</p>
<p>​			将 rpm 命令配合 grep 返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install kubelet kubeadm kubectl </span><br><span class="line">rpm -qa | grep kube</span><br></pre></td></tr></table></figure>

<h5 id="6-计算节点获取必备镜像"><a href="#6-计算节点获取必备镜像" class="headerlink" title="6.计算节点获取必备镜像"></a>6.计算节点获取必备镜像</h5><p>​			在所有 node 节点中使用 docker 命令拉取安装 kubernetes 基础镜像，拉取 完成后使用 docker 命令查看镜像列表。【1 分】 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>



<h5 id="7-kubeadm-安装-master"><a href="#7-kubeadm-安装-master" class="headerlink" title="7.kubeadm 安装 master"></a>7.kubeadm 安装 master</h5><p>​			使用 kubeadm 命令初始化 master 节点，设置 kubernetes 虚拟内部网段地址 为 10.244.0.0&#x2F;16，然后使用 kube-flannel.yaml 完成控制节点初始化设置，完成后使用命令查看集群状态和所有 pod。</p>
<p>​			 将以上命令和返回结果提交到答题框。【2 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.18.1 --apiserver-advertise-address=192.168.20.10 --image-repository 192.168.20.30/library --pod-network-cidr=10.244.0.0/16</span><br><span class="line"></span><br><span class="line">kubectl cluster-info </span><br><span class="line">kubectl get pods -A </span><br></pre></td></tr></table></figure>

<h5 id="8-安装-kubernetes"><a href="#8-安装-kubernetes" class="headerlink" title="8.安装 kubernetes"></a>8.安装 kubernetes</h5><p>​			网络插件 使用 kube-flannel.yaml 安装 kubernetes 网络插件，安装完成后使用命令查看节点状态。完成后使用命令查看集群状态。</p>
<p>​			将集群状态查看命令和返回结果 提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sed -i &quot;s/quay.io\/coreos/192.168.20.30\/library/g&quot; /opt/yaml/flannel/kube-flannel.yaml		# 需要修改</span><br><span class="line">kubectl apply -f /opt/yaml/flannel/kube-flannel.yaml</span><br><span class="line">kubectl cluster-info </span><br></pre></td></tr></table></figure>

<h5 id="9-kubernetes-图形化界面的安装"><a href="#9-kubernetes-图形化界面的安装" class="headerlink" title="9.kubernetes 图形化界面的安装"></a>9.kubernetes 图形化界面的安装</h5><p>​			安装 kubernetes dashboard 界面，完成后查看首页然后将 kubernetes das hboard 界面截图提交到答题框。【1 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建证书</span></span><br><span class="line">mkdir dashboard-certs</span><br><span class="line">cd dashboard-certs/</span><br><span class="line">kubectl create namespace kubernetes-dashboard</span><br><span class="line">openssl genrsa -out dashboard.key 2048</span><br><span class="line">openssl req -days 36000 -new -out dashboard.csr -key dashboard.key -subj &#x27;/CN=dashboard-cert&#x27;</span><br><span class="line">openssl x509 -req -in dashboard.csr -signkey dashboard.key -out dashboard.crt</span><br><span class="line">kubectl create secret generic kubernetes-dashboard-certs --from-file=dashboard.key --from-file=dashboard.crt -n kubernetes-dashboard</span><br><span class="line">sed -i &quot;s/kubernetesui/192.168.20.30\/library/g&quot; /opt/yaml/dashboard/recommended.yaml		#需要修改</span><br><span class="line">kubectl apply -f /opt/yaml/dashboard/recommended.yaml</span><br><span class="line">kubectl apply -f /opt/yaml/dashboard/dashboard-adminuser.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">界面登录后，会让你输入token，你需要获取token</span></span><br><span class="line">kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep dashboard-admin | awk &#x27;&#123;print $1&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230315200234963.png" alt="image-20230315200234963"></p>
<h5 id="10-扩展计算节点"><a href="#10-扩展计算节点" class="headerlink" title="10.扩展计算节点"></a>10.扩展计算节点</h5><p>​			在 master 节点上使用 kubeadm命令查看 token，在所有 node 节点上使用 kubeadm 命令将 node 节点加入 kubernetes 集群。完成后在 master 节点上查看所 有节点状态。 </p>
<p>​			将集群状态查看命令和返回结果提交到答题框。【0.5 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create --print-join-command</span><br><span class="line">kubeadm token list</span><br><span class="line"></span><br><span class="line">kubeadm join 192.168.20.10:6443 --token z636b2.aybrn1srspf8jgxl \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:2426de68ac6fa11b30d74fd73a9712c65e4df10729331a5dfc212da64de8c3b8 </span><br><span class="line"></span><br><span class="line">kubectl get nodes </span><br></pre></td></tr></table></figure>

<h4 id="任务-3-Kubernetes-运维任务（15-分）"><a href="#任务-3-Kubernetes-运维任务（15-分）" class="headerlink" title="任务 3 Kubernetes 运维任务（15 分）"></a>任务 3 Kubernetes 运维任务（15 分）</h4><h5 id="1-使用-dockerfile-构建-dokcer-镜像"><a href="#1-使用-dockerfile-构建-dokcer-镜像" class="headerlink" title="1.使用 dockerfile 构建 dokcer 镜像"></a>1.使用 dockerfile 构建 dokcer 镜像</h5><p>​			以 mysql:5.7 镜像为基础镜像，制作一个mysql镜像，可以将提供的sql文件初始化到 mysql 数据库中，然后使用编写的 dockerfile文件将镜像制作出来，名称为 mysql:latest，并将该镜像上传至前面所搭建的harbor仓库中，编写YAML文件，验证数据库内容。 </p>
<p>​			完成后将 dockerfile 文件内容及harbor仓库镜像列表、数据库内容提交到答题框。【1分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@master mysql]# cat Dockerfile </span><br><span class="line">FROM 192.168.20.30/library/mysql@sha256:bfcef110bc3892d329ea483fd3e69fc5162a36f1b9089275c7f8bf64717787c0</span><br><span class="line">MAINTAINER chinaskill</span><br><span class="line">WORKDIR /docker-entrypoint-initdb.d</span><br><span class="line">ENV LANG=C.UTF-8</span><br><span class="line">ADD init.sql .</span><br><span class="line"></span><br><span class="line">[root@master mysql]# cat init.sql </span><br><span class="line">create database `test`;</span><br><span class="line">SET character_set_client = utf8;</span><br><span class="line">use test;</span><br><span class="line">create table user(</span><br><span class="line">`id` int(4) primary key,</span><br><span class="line">`name` varchar(20)</span><br><span class="line">)engine=innodb charset=utf8;</span><br><span class="line">insert into user values(1,&#x27;小明&#x27;);</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动mysql容器</span></span><br><span class="line">docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=000000 mysql:latest</span><br><span class="line"></span><br><span class="line">docker tag mysql:latest 192.168.20.30/library/mysql:latest</span><br><span class="line">docker push 192.168.20.30/library/mysql:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">yml文件略</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230316100858507.png" alt="image-20230316100858507"></p>
<h5 id="2-持久化存储"><a href="#2-持久化存储" class="headerlink" title="2.持久化存储"></a>2.持久化存储</h5><p>​			搭建 NFS 共享存储，配置 nfs-provisioner，创建 storageclass，通过 storageclass 动态生成 pvc，大小为 1Gi，修改标准 nfs-deployment.yaml 文件， 编写 storageclass.yaml 和 pvc.yaml 文件，将最终 pvc 状态截图和 yaml 文件提 交至答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nfs-utils</span><br><span class="line">systemctl start rpcbind nfs &amp;&amp; systemctl enable rpcbind nfs</span><br><span class="line"></span><br><span class="line">[root@master ~]# cat /etc/exports</span><br><span class="line">/root/nfs 192.168.20.0/24(rw,sync,no_root_squash)		</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">rw：读写权限</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">sync</span>：同时将数据写入到内存和硬盘中，不丢失数据；</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">no_root_squash：当 NFS 客户端以 root 身份访问时，映射为 NFS 服务器的 root 管理员；</span></span><br><span class="line"></span><br><span class="line">[root@master ~]# showmount -e 127.0.0.1			# 查看目录是否可以被挂载</span><br><span class="line">Export list for 127.0.0.1:</span><br><span class="line">/root/nfs 192.168.20.0/24</span><br><span class="line"></span><br><span class="line">[root@master ~]# cat rbac.yaml </span><br><span class="line">---</span><br><span class="line">apiVersion: v1	# 创建身份认证账号名字为nfs-client-provisioner</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line"> name: nfs-client-provisioner</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1	# 赋予集群，集群中的资源特定的权限</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line"> name: nfs-client-provisioner-runner</span><br><span class="line">rules:</span><br><span class="line"> - apiGroups: [&quot;&quot;]</span><br><span class="line">   resources: [&quot;persistentvolumes&quot;]</span><br><span class="line">   verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;,&quot;create&quot;,&quot;delete&quot;]</span><br><span class="line"> - apiGroups: [&quot;&quot;]</span><br><span class="line">   resources: [&quot;persistentvolumeclaims&quot;]</span><br><span class="line">   verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;,&quot;update&quot;]</span><br><span class="line"> - apiGroups: [&quot;storage.k8s.io&quot;]</span><br><span class="line">   resources: [&quot;storageclasses&quot;]</span><br><span class="line">   verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;]</span><br><span class="line"> - apiGroups: [&quot;&quot;]</span><br><span class="line">   resources: [&quot;events&quot;]</span><br><span class="line">   verbs: [&quot;create&quot;,&quot;update&quot;,&quot;patch&quot;]</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1	# 集群绑定，绑定对应的账号，以及集群权限</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line"> name: run-nfs-client-provisioner</span><br><span class="line">subjects:		</span><br><span class="line"> - kind: ServiceAccount</span><br><span class="line">   name: nfs-client-provisioner</span><br><span class="line">   namespace: default</span><br><span class="line">roleRef:</span><br><span class="line"> kind: ClusterRole</span><br><span class="line"> name: nfs-client-provisioner-runner</span><br><span class="line"> apiGroup: rbac.authorization.k8s.io</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: Role</span><br><span class="line">metadata:</span><br><span class="line"> name: leader-locking-nfs-client-provisioner</span><br><span class="line">rules:</span><br><span class="line"> - apiGroups: [&quot;&quot;]</span><br><span class="line">   resources: [&quot;endpoints&quot;]</span><br><span class="line">   verbs: [&quot;get&quot;,&quot;list&quot;,&quot;watch&quot;,&quot;create&quot;,&quot;update&quot;,&quot;patch&quot;]</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: RoleBinding</span><br><span class="line">metadata:</span><br><span class="line"> name: leader-locking-nfs-client-provisioner</span><br><span class="line">subjects:</span><br><span class="line"> - kind: ServiceAccount</span><br><span class="line">   name: nfs-client-provisioner</span><br><span class="line"></span><br><span class="line">roleRef:</span><br><span class="line"> kind: Role</span><br><span class="line"> name: leader-locking-nfs-client-provisioner</span><br><span class="line"> apiGroup: rbac.authorization.k8s.io</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@master ~]# cat deployment.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line"> name: nfs-client-provisioner</span><br><span class="line">spec:</span><br><span class="line"> replicas: 1</span><br><span class="line"> selector:</span><br><span class="line">  matchLabels:</span><br><span class="line">   app: nfs-client-provisioner</span><br><span class="line"> template:</span><br><span class="line">  metadata:</span><br><span class="line">   labels:</span><br><span class="line">    app: nfs-client-provisioner</span><br><span class="line">  spec: </span><br><span class="line">   serviceAccountName: nfs-client-provisioner		# 参数与上身份认证的账号名一致</span><br><span class="line">   containers:</span><br><span class="line">   - name: nfs-client-provisioner</span><br><span class="line">     image: 192.168.20.30/library/nfs-client-provisioner		# 根据docker images显示的位置</span><br><span class="line">     imagePullPolicy: IfNotPresent</span><br><span class="line">     volumeMounts:</span><br><span class="line">     - name: nfs-client-root		# 与下volumes名字一致</span><br><span class="line">       mountPath: /persistentvolumes</span><br><span class="line">     env:</span><br><span class="line">     - name: PROVISIONER_NAME</span><br><span class="line">       value: nfs-client		# 与动态存储的provisioner名一致</span><br><span class="line">     - name: NFS_SERVER</span><br><span class="line">       value: 192.168.20.10</span><br><span class="line">     - name: NFS_PATH</span><br><span class="line">       value: /root/nfs</span><br><span class="line">   volumes:</span><br><span class="line">   - name: nfs-client-root</span><br><span class="line">     nfs:</span><br><span class="line">      server: 192.168.20.10</span><br><span class="line">      path: /root/nfs</span><br><span class="line">      </span><br><span class="line">[root@master ~]# cat storageclass.yaml 	# 创建动态存储</span><br><span class="line">apiVersion: storage.k8s.io/v1</span><br><span class="line">kind: StorageClass</span><br><span class="line">metadata:</span><br><span class="line"> name: storage-test</span><br><span class="line">provisioner: nfs-client</span><br><span class="line"></span><br><span class="line">[root@master ~]# cat pvc.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line"> name: pvc</span><br><span class="line">spec:</span><br><span class="line"> accessModes:</span><br><span class="line"> - ReadWriteMany</span><br><span class="line"> resources:</span><br><span class="line">  requests:</span><br><span class="line">   storage: 1Gi</span><br><span class="line"> storageClassName: storage-test		# 与sc名称一致</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">[root@master ~]# kubectl get deployment </span><br><span class="line">NAME                     READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nfs-client-provisioner   1/1     1            1           8m26s</span><br><span class="line">[root@master ~]# kubectl get pvc</span><br><span class="line">NAME   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">pvc    Bound    pvc-9ea215c6-7154-4502-b79e-74d4b9040234   1Gi        RWX            storage-test   3m30s</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="3-编写-deployment-文件"><a href="#3-编写-deployment-文件" class="headerlink" title="3.编写 deployment 文件"></a>3.编写 deployment 文件</h5><p>​			将提供的 nginx:latest镜像上传至 harbor 镜像仓库，使用该镜像编写 deployment 文件，要求将已创建的 pvc 挂载至&#x2F;html 目录下，副本数 1，实现资源限制:需求内存 300Mi，需求 CPU 300M，限制内存 450Mi，限制 CPU450M，将 POD 状态截图和 yaml 文件提交至答题框。【3 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat nginx-deployment.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata: </span><br><span class="line"> name: nginx</span><br><span class="line">spec:</span><br><span class="line"> replicas: 1</span><br><span class="line"> selector:</span><br><span class="line">  matchLabels:</span><br><span class="line">   app: nginx</span><br><span class="line"> template: </span><br><span class="line">  metadata:</span><br><span class="line">   name: nginx</span><br><span class="line">   labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  spec:</span><br><span class="line">   containers:</span><br><span class="line">   - name: nginx</span><br><span class="line">     image: 192.168.20.30/library/nginx:latest</span><br><span class="line">     imagePullPolicy: IfNotPresent</span><br><span class="line">     ports:</span><br><span class="line">     - name: container-port</span><br><span class="line">       containerPort: 80</span><br><span class="line">     resources:			# 资源限制</span><br><span class="line">      requests:</span><br><span class="line">       memory: 300Mi</span><br><span class="line">       cpu: 300m </span><br><span class="line">      limits:</span><br><span class="line">       memory: 450Mi</span><br><span class="line">       cpu: 450m</span><br><span class="line">   volumes:</span><br><span class="line">   - name: pvc</span><br><span class="line">     persistentVolumeClaim:		# 与上一步创建pvc的名字一致</span><br><span class="line">      claimName: pvc</span><br><span class="line">      </span><br><span class="line"> [root@master ~]# kubectl get pods -n default</span><br><span class="line">NAME                                      READY   STATUS    RESTARTS   AGE</span><br><span class="line">nfs-client-provisioner-6b994db9bd-mg9gq   1/1     Running   0          27m</span><br><span class="line">nginx-77b4bcff64-b45fv                    1/1     Running   0          100s</span><br></pre></td></tr></table></figure>

<h5 id="4-创建-service-服务，提供对外访问接口"><a href="#4-创建-service-服务，提供对外访问接口" class="headerlink" title="4.创建 service 服务，提供对外访问接口"></a>4.创建 service 服务，提供对外访问接口</h5><p>​			基于 nginx 的 pod 服务，编写一个 service 名称为 nginx-svc，代理 nginx 的服务端口，端口类型为 nodeport，创建成功后可以通过该 service 访问 nginx。 </p>
<p>​			完成后提交 yaml 文件及访问截图至答题框。【3 分】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat service.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line"> name: nginx</span><br><span class="line">spec:</span><br><span class="line"> selector:</span><br><span class="line">  app: nginx</span><br><span class="line"> ports:</span><br><span class="line"> - port: 8000</span><br><span class="line">   targetPort: 80</span><br><span class="line">   protocol: TCP</span><br><span class="line"> type: NodePort		# svc类型</span><br><span class="line"> </span><br><span class="line"> [root@master ~]# cat pod.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line"> name: nginx</span><br><span class="line"> labels:</span><br><span class="line">  app: nginx</span><br><span class="line">spec:</span><br><span class="line"> containers:</span><br><span class="line"> - name: nginx</span><br><span class="line">   image: 192.168.20.30/library/nginx:latest</span><br><span class="line">   ports:</span><br><span class="line">   - containerPort: 80</span><br><span class="line"></span><br><span class="line">kubectl get pod -n default -o wide</span><br><span class="line">kubectl get svc </span><br><span class="line"></span><br><span class="line">[root@master ~]# curl 192.168.20.20:30616</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br></pre></td></tr></table></figure>

<h5 id="5-配置-metrics-server-实现资源监控"><a href="#5-配置-metrics-server-实现资源监控" class="headerlink" title="5.配置 metrics-server 实现资源监控"></a>5.配置 metrics-server 实现资源监控</h5><p>​			将已提供的 metrics-server 镜像上传至 harbor，修改 components.yaml， 创建 metrics-server，完成后，将 metrics-server 状态截图提交至答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改components.yaml文件，搜索image，将image地址改为harbor仓库地址</span></span><br><span class="line">[root@master ~]# kubectl get pods -A | grep metrics</span><br><span class="line">kube-system            metrics-server-568dc89bbc-npzwj              1/1     Running   0          67s</span><br><span class="line">kubernetes-dashboard   dashboard-metrics-scraper-6b4884c9d5-94kqd   1/1     Running   0          35h</span><br><span class="line"></span><br><span class="line">[root@master ~]# kubectl top nodes</span><br><span class="line">NAME     CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%   </span><br><span class="line">master   141m         3%     1288Mi          35%       </span><br><span class="line">node     27m          1%     641Mi           37% </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">爆出问题首先查看metrics的pod日志，根据日志报错的信息处理问题.</span></span><br><span class="line">报错 the server is currently unable to handle the request</span><br><span class="line">vim /etc/kubernetes/manifests/kube-apiserver.yaml </span><br><span class="line">	- --enable-aggregator-routing=true</span><br><span class="line">在args参数下添加</span><br><span class="line">	- --kubelet-preferred-address-types=InternalIP </span><br><span class="line">	- --kubelet-insecure-tls</span><br><span class="line">重新apply，并重启kubelet</span><br><span class="line">若报错，error: metrics not available yet</span><br><span class="line">	等待一会即可</span><br></pre></td></tr></table></figure>

<h5 id="6-配置弹性伸缩"><a href="#6-配置弹性伸缩" class="headerlink" title="6.配置弹性伸缩"></a>6.配置弹性伸缩</h5><p>​			编写 deployment-nginx-hpa.yaml 文件，要求最小副本数 1，最大副本数 3， 当整体的资源利用率超过 80%的时候实现自动扩容，将 yaml 文件提交至答题框。 【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# cat deployment-nginx-pod.yaml </span><br><span class="line">---</span><br><span class="line">apiVersion: autoscaling/v1</span><br><span class="line">kind: HorizontalPodAutoscaler</span><br><span class="line">metadata:</span><br><span class="line"> name: nginx-hpa</span><br><span class="line">spec: </span><br><span class="line"> maxReplicas: 3		# 最大副本</span><br><span class="line"> minReplicas: 1		# 最小副本</span><br><span class="line"> scaleTargetRef:	# 绑定deployment</span><br><span class="line">  apiVersion: apps/v1</span><br><span class="line">  kind: Deployment</span><br><span class="line">  name: nginx</span><br><span class="line"> targetCPUUtilizationPercentage: 80		# 资源利用率</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line"> name: nginx</span><br><span class="line">spec:</span><br><span class="line"> selector:</span><br><span class="line">  matchLabels:</span><br><span class="line">   app: nginx</span><br><span class="line"> template:</span><br><span class="line">  metadata:</span><br><span class="line">   name: nginx</span><br><span class="line">   labels:</span><br><span class="line">    app: nginx</span><br><span class="line">  spec:</span><br><span class="line">   containers:</span><br><span class="line">   - name: nginx</span><br><span class="line">     image: 192.168.20.30/library/nginx:latest</span><br><span class="line">     ports:</span><br><span class="line">     - containerPort: 80</span><br><span class="line">     resources:</span><br><span class="line">      requests:</span><br><span class="line">       cpu: 250m</span><br><span class="line">       memory: 300Mi</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试修改deployment的数量为5，查看deploy的pod数量</span></span><br><span class="line">kubectl scale deployment nginx --replicas=5</span><br><span class="line">[root@master ~]# kubectl get pods</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-6dff55bf48-87846   1/1     Running   0          100s</span><br><span class="line">nginx-6dff55bf48-dp7p4   1/1     Running   0          57m</span><br><span class="line">nginx-6dff55bf48-pxbjr   1/1     Running   0          100s</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">由于设置了最大pod数量限制，所以pod还是3个</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看hpa</span></span><br><span class="line">[root@master ~]# kubectl get hpa</span><br><span class="line">NAME        REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">nginx-hpa   Deployment/nginx   0%/80%    1         3         3          59m</span><br></pre></td></tr></table></figure>



<h5 id="7-压力测试"><a href="#7-压力测试" class="headerlink" title="7.压力测试"></a>7.压力测试</h5><p>​			安装 httpd-tools 工具，通过 service 提供的对外访问接口进行压力测试， 验证 HPA 弹性伸缩功能，将 HPA 状态和 POD 状态截图提交至答题框。【2 分】 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum -y install httpd-tools</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">进行压力测试</span></span><br><span class="line">ab -t 600 -n 1000000 -c 1000 http://192.168.20.20:31271/index.html </span><br><span class="line"></span><br><span class="line">kubectl get hpa</span><br><span class="line">kubectl get pod</span><br></pre></td></tr></table></figure>

<h2 id="C-场次题目：企业级应用的自动化部署和运维"><a href="#C-场次题目：企业级应用的自动化部署和运维" class="headerlink" title="C 场次题目：企业级应用的自动化部署和运维"></a>C 场次题目：企业级应用的自动化部署和运维</h2><h4 id="任务-1-企业级应用的自动化部署（15-分）"><a href="#任务-1-企业级应用的自动化部署（15-分）" class="headerlink" title="任务 1 企业级应用的自动化部署（15 分）"></a>任务 1 企业级应用的自动化部署（15 分）</h4><h5 id="1-ansible-自动化运维工具的安装【3-分】"><a href="#1-ansible-自动化运维工具的安装【3-分】" class="headerlink" title="1.ansible 自动化运维工具的安装【3 分】"></a>1.ansible 自动化运维工具的安装【3 分】</h5><p>​			请使用提供的软件包在 master 节点安装 ansible，安装完成后使用 ansibl e –version 命令验证是否安装成功。为所有节点添加 test 用户，设置用户密 码为 000000。为 test 用户设置免密 sudo，配置 ssh 免密登录，使 master 节点 能够免密登录所有节点的 test 用户。 </p>
<p>​			将 ansible –version 命令和回显粘贴到答题框</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">useradd <span class="built_in">test</span></span><br><span class="line">passwd <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/sudoers文件root    ALL=(ALL)       ALL的下一行添加 </span></span><br><span class="line"><span class="comment"># test    ALL=(ALL)       NOPASSWD: ALL</span></span><br><span class="line"></span><br><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id <span class="built_in">test</span>@192.168.20.50</span><br></pre></td></tr></table></figure>

<h5 id="2-ansible-自动化运维工具的初始化【3-分】"><a href="#2-ansible-自动化运维工具的初始化【3-分】" class="headerlink" title="2.ansible 自动化运维工具的初始化【3 分】"></a>2.ansible 自动化运维工具的初始化【3 分】</h5><p>​			创建 &#x2F;root&#x2F;ansible 目录作为工作目录，在该目录内创建 ansible.cfg 文 件并完成以下配置，清单文件位置为 &#x2F;root&#x2F;ansible&#x2F;inventory，登录用户为 test，登录时不需要输入密码。设置并行主机数量为 2，允许 test 用户免密提权 到 root。</p>
<p>​			 将 ansible.cfg 文件内容粘贴到答题框。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /root/ansible</span><br><span class="line">vim /root/ansible/ansible.cfg</span><br><span class="line"></span><br><span class="line">inventory  = /root/ansible/inventory		<span class="comment"># 清单文件</span></span><br><span class="line">sudo_user = <span class="built_in">test</span></span><br><span class="line">forks = 2</span><br><span class="line">ask_sudo_pass = <span class="literal">false</span></span><br><span class="line">ask_pass = <span class="literal">false</span> </span><br></pre></td></tr></table></figure>

<h5 id="3-主机清单的编写【2-分】"><a href="#3-主机清单的编写【2-分】" class="headerlink" title="3.主机清单的编写【2 分】"></a>3.主机清单的编写【2 分】</h5><p>​			编写主机清单文件，创建 master 用户组，master 用户组内添加 master 主 机；创建 node 用户组，node 组内添加 node1 和 node2 主机，主机名不得使用 I P 地址。 完成后执行 ansible-inventory –list 、ansible all -m ping 和 ansib le all -a “id” 命令，将这三条命令返回结果粘贴到答题框。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">vim /root/ansible/inventory</span><br><span class="line"></span><br><span class="line">[master]</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line">[node]</span><br><span class="line">node1</span><br><span class="line">node2</span><br><span class="line"></span><br><span class="line">[root@master ~]# ansible-inventory --list</span><br><span class="line">[WARNING]: Found both group and host with same name: master</span><br><span class="line">&#123;</span><br><span class="line">    &quot;_meta&quot;: &#123;</span><br><span class="line">        &quot;hostvars&quot;: &#123;&#125;</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;all&quot;: &#123;</span><br><span class="line">        &quot;children&quot;: [</span><br><span class="line">            &quot;master&quot;, </span><br><span class="line">            &quot;node&quot;, </span><br><span class="line">            &quot;ungrouped&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;master&quot;: &#123;</span><br><span class="line">        &quot;hosts&quot;: [</span><br><span class="line">            &quot;master&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;, </span><br><span class="line">    &quot;node&quot;: &#123;</span><br><span class="line">        &quot;hosts&quot;: [</span><br><span class="line">            &quot;node-1&quot;, </span><br><span class="line">            &quot;node-2&quot;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ansible all -m ping  # 返回pong即可</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="4-使用自动化工具对-master-节点进行初始化【2-分】"><a href="#4-使用自动化工具对-master-节点进行初始化【2-分】" class="headerlink" title="4.使用自动化工具对 master 节点进行初始化【2 分】"></a>4.使用自动化工具对 master 节点进行初始化【2 分】</h5><p>​				请编写 prometheus.yml 控制 master 主机组，使用对应模块将 SELinux 临时 状态和开机启动状态也设置为 disabled。请使用 ansible 对应模块安装时间同 步服务，使用文本编辑模块将该服务的作用域设置为 0.0.0.0&#x2F;0，并设置状态为 启动和开机自动启动。首先将提供的 prometheus-2.37.0.linux-amd64.tar.gz 使用文件拷贝模块将该压缩包拷贝到目标主机的&#x2F;usr&#x2F;local&#x2F; 下，使用 shell 模 块解压该压缩包。 </p>
<p>​			完成后提交 yml文件和ansible 运行结果。 </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># cat prometheus.yml </span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">promutheus</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">master</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">close</span> <span class="string">selinux</span>	<span class="comment"># 关闭selinux</span></span><br><span class="line">     <span class="attr">shell:</span> <span class="string">sed</span> <span class="string">-i</span> <span class="string">&#x27;s/enforcing/disabled/g&#x27;</span> <span class="string">/etc/selinux/config</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">configure</span> <span class="string">chronyc</span>		<span class="comment"># 修改chrony配置文件</span></span><br><span class="line">     <span class="attr">shell:</span> <span class="string">echo</span> <span class="string">&#x27;allow 0.0.0.0/0&#x27;</span> <span class="string">&gt;&gt;</span> <span class="string">/etc/chrony.conf</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">chronyc</span></span><br><span class="line">     <span class="attr">service:</span> <span class="string">name=chronyd</span> <span class="string">state=started</span> <span class="string">enable=yes</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">copy:</span> <span class="string">src=/root/prometheus-2.37.1.linux-amd64.tar.gz</span> <span class="string">dest=/usr/local</span></span><br><span class="line">   <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">unzip</span> <span class="string">file</span></span><br><span class="line">     <span class="attr">shell:</span> <span class="string">tar</span> <span class="string">-zxvf</span> <span class="string">prometheus-2.37.1.linux-amd64.tar.gz</span> <span class="string">chdir=/usr/local</span></span><br><span class="line">     </span><br></pre></td></tr></table></figure>



<h5 id="5-使用自动化运维工具完成企业级应用的部署【5-分】"><a href="#5-使用自动化运维工具完成企业级应用的部署【5-分】" class="headerlink" title="5.使用自动化运维工具完成企业级应用的部署【5 分】"></a>5.使用自动化运维工具完成企业级应用的部署【5 分】</h5><p>​			编写 prometheus.yml.j2 模板文件，将所有 node 节点信息添加到该文件中， 但是被管节点的主机名信息必须使用变量 IP 地址可以手动输入。完成后请创建 node_exporter.yml 文件，编写第一个 play，将该 play 命名为 node，该 play 控制的主机组为 node。使用 ansible 模块将 node_exporter-1.3.1.linux-amd6 4.tar.gz 发送到 node 主机组的 &#x2F;usr&#x2F;local&#x2F; 下，使用一个 shell 模块解压该 压缩包，并启动该服务。随后编写第二个 play，将第二个 play 命名为 master， 第二个 play 控制 master 节点。首先使用 ansible 模块将 prometheus.yml.j2 文 件传输到 master 节点，然后使用script 模块将 prometheus 启动。使用对应模块将 grafana-8.1.2-1.x86_64.rpm 包发送到被控节点的 &#x2F;mnt&#x2F; 目录下，然后使用对应模块将该软件包安装，安装完成后设置 grafana 服务启动并设置开机自动启动。</p>
<p>​			使用浏览器登录prometheus查看 prometheus 是否成功监控所有 node 节点。 请将浏览器反馈的结果截图、prometheus.yml.j2 文件的内容、node_exporter.yml文件内容及运行结果提交到答题框。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@master test]# cat prometheus.yml.j2 	# 只截取了修改部分</span><br><span class="line">&#123;% set node1_ipadd = &quot;192.168.20.50&quot; %&#125;	</span><br><span class="line">&#123;% set node1_ipadd = &quot;192.168.20.60&quot; %&#125;</span><br><span class="line">  - job_name: &quot;node&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">     - targets: [&quot;&#123;&#123; node1_ipadd &#125;&#125;:9100&quot;,&quot;&#123;&#123; node2_ipadd &#125;&#125;:9100&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写启动脚本</span></span><br><span class="line">[root@master test]# cat start.sh </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line">cd /opt/prometheus-2.37.1.linux-amd64</span><br><span class="line">nohup ./prometheus --config.file=prometheus.yml --web.enable-lifecycle &gt; /applog/prometheus/prometheus.log 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">node_exporter.yml</span> </span><br><span class="line">[root@master test]# cat node_exporter.yml </span><br><span class="line">---</span><br><span class="line">- name: node</span><br><span class="line">  hosts: node</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: copy file</span><br><span class="line">    copy: src=/root/node_exporter-1.3.1.linux-amd64.tar.gz dest=/usr/local</span><br><span class="line">  - name: unzip file</span><br><span class="line">    shell: tar -zxvf node_exporter-1.3.1.linux-amd64.tar.gz chdir=/usr/local</span><br><span class="line">  - name: install service</span><br><span class="line">    shell: nohup /usr/local/node_exporter-1.3.1.linux-amd64/node_exporter &amp; </span><br><span class="line"></span><br><span class="line">- name: master</span><br><span class="line">  hosts: master</span><br><span class="line">  remote_user: root</span><br><span class="line">  tasks:</span><br><span class="line">  - name: template</span><br><span class="line">    template: src=/root/test/prometheus.yml.j2 dest=/root/prometheus-2.37.1.linux-amd64/prometheus.yml</span><br><span class="line">  - name: script service</span><br><span class="line">    script: /root/test/start.sh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">grafana</span> </span><br><span class="line">ansible node -m copy -a &quot;src=grafana-8.1.2-1.x86_64.rpm dest=/mnt&quot;</span><br><span class="line">ansible node -m shell -a &#x27;rpm -ivh grafana-8.1.2-1.x86_64.rpm&#x27;</span><br><span class="line">ansible node -m yum -a &quot;name=grafana state=present&quot;</span><br><span class="line">ansible node -m service -a &quot;name=grafana-server state=started enabled=yes&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">若grafana rpm包安装时产生依赖问题则安装对应软件包即可</span></span><br><span class="line">yum -y install urw-fonts </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">截取图片有误应该是node节点下两个被管控主机</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230317192354103.png" alt="image-20230317192354103"></p>
<h4 id="任务-2-企业级应用的运维（12-分）"><a href="#任务-2-企业级应用的运维（12-分）" class="headerlink" title="任务 2 企业级应用的运维（12 分）"></a>任务 2 企业级应用的运维（12 分）</h4><h5 id="1-使用-prometheus-监控-mysqld-服务【3-分】"><a href="#1-使用-prometheus-监控-mysqld-服务【3-分】" class="headerlink" title="1.使用 prometheus 监控 mysqld 服务【3 分】"></a>1.使用 prometheus 监控 mysqld 服务【3 分】</h5><p>​			将提供的 mysqld_exporter-0.14.0.linux-amd64.tar.gz 发送到 agent 虚 拟机 &#x2F;usr&#x2F;local&#x2F; 目录下解压并安装 mariadb 服务。进入 mariadb 数据库中创 建 mysqld_monitor 用户并授权，然后创建 mariadb 配置文件，内容为数据库用 户名密码。启动mysqld_exporter 组件确保 9104 端口启动。回到 prometheus 节 点修改 prometheus.yml 文件并添加 mysql 被监控信息。重启 prometheus，随后 web 界面刷新并查看 mysqld 被控信息。 </p>
<p>​			将以上操作提交到答题框。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">scp mysqld_exporter-0.14.0.linux-amd64.tar.gz 192.168.20.130://usr/local/</span><br><span class="line"></span><br><span class="line">yum -y install mariadb mariadb-server &amp;&amp; systemctl start mariadb &amp;&amp; systemctl enable mariadb</span><br><span class="line"></span><br><span class="line">mysqladmin -u root password 000000</span><br><span class="line">grant replication client,process on *.* to &#x27;mysql_monitor&#x27;@localhost identified by &#x27;mysql_monitor&#x27;;	# 创建monoitor用户</span><br><span class="line">grant select on *.* to mysql_monitor@localhost;</span><br><span class="line"></span><br><span class="line">[root@haproxy mysqld_exporter-0.14.0.linux-amd64]# cat .my.cnf </span><br><span class="line">[client]</span><br><span class="line">user=mysql_monitor</span><br><span class="line">password=mysql_monitor</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">prometheus.yml配置内容</span></span><br><span class="line">  - job_name: &quot;mysql&quot;</span><br><span class="line">    static_configs:</span><br><span class="line">     - targets: [&quot;192.168.20.130:9104&quot;]</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230318114711226.png" alt="image-20230318114711226"></p>
<h5 id="2-安装-alertmanager-报警组件【3-分】"><a href="#2-安装-alertmanager-报警组件【3-分】" class="headerlink" title="2.安装 alertmanager 报警组件【3 分】"></a>2.安装 alertmanager 报警组件【3 分】</h5><p>​			将提供的alertmanager-0.21.0.linux-amd64.tar.gz上传到prometheus节点 &#x2F;usr&#x2F;local&#x2F; 目录下并解压，创建软连接 alertmanager-0.23.0.linux-amd64&#x2F;alertmanager。创建service启动文件，然后启动 alertmanager 查看 9093 端口。在 prometheus.yml 配置文件中添加 alertmanager信息并重新启动 prometheus 服务，在 agent 上停止 node_exporter 服务。到 web 界面中查看警报管理器状态是否正常和agent状态是否异常。</p>
<p>​			将操作命令及截图提交到答题框。 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local &amp;&amp; tar -zxvf alertmanager-0.21.0.linux-amd64.tar.gz </span><br><span class="line">ln -s /usr/local/alertmanager-0.21.0.linux-amd64/alertmanager.yml /root/</span><br><span class="line"></span><br><span class="line">[root@master system]# cat alertmanager.service </span><br><span class="line">[unit]</span><br><span class="line">Description=alertmanager</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/usr/local/alertmanager-0.21.0.linux-amd64/alertmanager --storage.path=/usr/local/alertmanager-0.21.0.linux-amd64/data --config.file=/root/alertmanager.yml</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=mutli-user.target</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230318130359930.png" alt="image-20230318130359930"></p>
<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230318130456731.png" alt="image-20230318130456731"></p>
<h5 id="3-alertmanager-告警邮件文件编写【3-分】"><a href="#3-alertmanager-告警邮件文件编写【3-分】" class="headerlink" title="3.alertmanager 告警邮件文件编写【3 分】"></a>3.alertmanager 告警邮件文件编写【3 分】</h5><p>​			Prometheus虚拟机 &#x2F;usr&#x2F;local&#x2F;akertmanager&#x2F;中存在着一个 alertmanager.yml文件请根据提供的地址和模板编写告警所发送到的 email 邮箱地址信息。 </p>
<p>​			将配置文件中编写的内容提交到答题框。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">root@master</span> <span class="string">alertmanager-0.21.0.linux-amd64</span>]<span class="comment"># cat alertmanager.yml</span></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">resolve_timeout:</span> <span class="string">5m</span></span><br><span class="line">  <span class="attr">smtp_smarthost:</span> <span class="string">&#x27;smtp.qq.com:465&#x27;</span></span><br><span class="line">  <span class="attr">smtp_from:</span> <span class="string">&#x27;1400952418@qq.com&#x27;</span></span><br><span class="line">  <span class="attr">smtp_auth_username:</span> <span class="string">&#x27;1400952418@qq.com&#x27;</span></span><br><span class="line">  <span class="attr">smtp_auth_password:</span> <span class="string">&quot;ukloogrfwdymjdhj&quot;</span></span><br><span class="line">  <span class="attr">smtp_require_tls:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">route:</span></span><br><span class="line">  <span class="attr">group_by:</span> [<span class="string">&#x27;alertname&#x27;</span>]</span><br><span class="line">  <span class="attr">group_wait:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">group_interval:</span> <span class="string">10s</span></span><br><span class="line">  <span class="attr">repeat_interval:</span> <span class="string">1h</span></span><br><span class="line">  <span class="attr">receiver:</span> <span class="string">&#x27;email&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">receivers:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&#x27;email&#x27;</span></span><br><span class="line">  <span class="attr">email_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">to:</span> <span class="string">&#x27;1400952418@qq.com&#x27;</span></span><br><span class="line">  <span class="attr">webhook_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">url:</span> <span class="string">&#x27;http://127.0.0.1:5001/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">inhibit_rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">source_match:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&#x27;critical&#x27;</span></span><br><span class="line">    <span class="attr">target_match:</span></span><br><span class="line">      <span class="attr">severity:</span> <span class="string">&#x27;warning&#x27;</span></span><br><span class="line">    <span class="attr">equal:</span> [<span class="string">&#x27;alertname&#x27;</span>, <span class="string">&#x27;dev&#x27;</span>, <span class="string">&#x27;instance&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h5 id="4-alertmanager-告警规则编写【3-分】"><a href="#4-alertmanager-告警规则编写【3-分】" class="headerlink" title="4.alertmanager 告警规则编写【3 分】"></a>4.alertmanager 告警规则编写【3 分】</h5><p>​			在 prometheus虚拟机的prometheus 路径下存在一个 &#x2F;rules 目录，目录下 有一个 node_rules.yml 文件。请根据提供信息仿照模板编写： </p>
<p>​			（1）内存大于 50%报警规则； </p>
<p>​			（2）cpu 资源利用率大于 75%报警规则； </p>
<p>​			（3）主机磁盘每秒读取数据&gt;50MB%报警规则； </p>
<p>​			部门名称可为工位号，将配置文件内容提交到答题框。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@master rules]# cat node_rules.yml </span><br><span class="line">groups:</span><br><span class="line">- name: alertmanager_pod.rules</span><br><span class="line">  rules: </span><br><span class="line">  - alert: Pod_all_cpu_usage</span><br><span class="line">    expr: (sum by(name)(rate(container_cpu_usage_seconds_total&#123;image!=&quot;&quot;&#125;[5m]))*100) &gt; 10</span><br><span class="line">    for: 2m</span><br><span class="line">    labels:</span><br><span class="line">      severity: critical</span><br><span class="line">      service: pods</span><br><span class="line">    annotations:</span><br><span class="line">      description: 容器 &#123;&#123; $labels.name &#125;&#125; CPU 资源利用率大于 10% , (current value is &#123;&#123; $value &#125;&#125;)</span><br><span class="line">      summary: &quot;Dev CPU 负载告警&quot;</span><br><span class="line"></span><br><span class="line">  - alert: 主机内存使用率告警</span><br><span class="line">    expr: (1 - (node_memory_MemAvailable_bytes / (node_memory_MemTotal_bytes))) * 100 &gt; 75</span><br><span class="line">    for: 15m</span><br><span class="line">    labels:</span><br><span class="line">      severity: warning</span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;内存利用率大于75%, 实例: &#123;&#123; $labels.instance &#125;&#125;，当前值：&#123;&#123; $value &#125;&#125;%&quot;</span><br><span class="line"></span><br><span class="line">  - alert: UnusualDiskReadRate</span><br><span class="line">    expr: sum by (instance) (irate(node_disk_bytes_read[2m])) / 1024 / 1024 &gt; 50</span><br><span class="line">    for: 5m</span><br><span class="line">    labels:</span><br><span class="line">      severity: warning</span><br><span class="line">    annotations:</span><br><span class="line">      summary: &quot;Unusual disk read rate (instance &#123;&#123; $labels.instance &#125;&#125;)&quot;</span><br><span class="line">      description: &quot;Disk is probably reading too much data (&gt; 50 MB/s) (current value: &#123;&#123; $value &#125;&#125;)&quot;</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">检验规则文件,若显示seccuss则编写正确</span></span><br><span class="line">[root@master rules]# /root/prometheus-2.37.1.linux-amd64/promtool check rules node_rules.yml </span><br><span class="line">Checking node_rules.yml</span><br><span class="line">SUCCESS: 3 rules found</span><br></pre></td></tr></table></figure>



<h2 id="任务-3-企业级微服务运维（13-分）"><a href="#任务-3-企业级微服务运维（13-分）" class="headerlink" title="任务 3 企业级微服务运维（13 分）"></a>任务 3 企业级微服务运维（13 分）</h2><h5 id="1-在-Kubernetes-集群安装-istio【4-分】"><a href="#1-在-Kubernetes-集群安装-istio【4-分】" class="headerlink" title="1.在 Kubernetes 集群安装 istio【4 分】"></a>1.在 Kubernetes 集群安装 istio【4 分】</h5><p>​			将 istio-1.10.1-linux-amd64.tar 上传至 master 节点并解压至&#x2F;root 目录 下，将 &#x2F;istio 目录内容器镜像文件上传至各 node 节点中并且加载，完成 istio 初始化安装，将部署成功后三台 POD 状态截图提交答题框。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf istio-1.10.1-linux-amd64.tar.gz </span><br><span class="line">cp istioctl /usr/local/bin/istioctl</span><br><span class="line"></span><br><span class="line">istioctl install --set profile=demo -y</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230318152151496.png" alt="image-20230318152151496"></p>
<h5 id="2-部署基于在线书店-bookinfo【6-分】"><a href="#2-部署基于在线书店-bookinfo【6-分】" class="headerlink" title="2.部署基于在线书店 bookinfo【6 分】"></a>2.部署基于在线书店 bookinfo【6 分】</h5><p>​			Bookinfo 是一个在线书店微服务应用，Bookinfo 应用分为四个单独的微 服务：</p>
<p>​			（1）productpage。这个微服务会调用 details 和 reviews 两个微服务， 用来生成页面。</p>
<p>​			（2）details。 这个微服务中包含了书籍的信息。</p>
<p>​			（3）revie ws。这个微服务中包含了书籍相关的评论。它还会调用 ratings 微服务。</p>
<p>​			（4） ratings。这个微服务中包含了由书籍评价组成的评级信息。 </p>
<p>​		reviews 微服务有 3 个版本：v1 版本不会调用 ratings 服务；v2 版本会 调用 ratings 服务，并使用 1 到 5 个黑色星形图标来显示评分信息；v3 版本会 调用 ratings 服务，并使用 1 到 5 个红色星形图标来显示评分信息。 实现该应用服务网格的部署，利用 Istio 控制平面为应用提供服务路由、 监控数据收集以及策略实施等功能。部署架构如下： </p>
<p>​			（1）编写 Dockerfile 构建 productpage:v1.0 镜像，具体要求如下：</p>
<p>​				 基础镜像：centos:7.9.2009；</p>
<p>​				 安装 Python3.6.8 工具； 安装 productpage 服务并设置开机自启。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>​			（2）规划应用微服务部署架构，在容器集群中通过修改微服务应用的 yaml 文件来完成 bookinfo 微服务应用的部署。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">主要修改image</span></span><br><span class="line">kubectl apply -f bookinfo/bookinfo.yaml</span><br></pre></td></tr></table></figure>

<p>​			（3）在容器集群中设置熔断规则，对 Bookinfo 其中的 productpage 微服 务设置熔断规则，并通过负载 fortio 测试客户端触发熔断机制进行验证。 </p>
<h5 id="3-部署网关接口实现对外服务【3-分】"><a href="#3-部署网关接口实现对外服务【3-分】" class="headerlink" title="3.部署网关接口实现对外服务【3 分】"></a>3.部署网关接口实现对外服务【3 分】</h5><p>​			通过 istio-1.10.1&#x2F;samples&#x2F;bookinfo&#x2F;networking&#x2F;bookinfo-gateway.yam l 部署 bookinfo 网关，通过外部浏览器登陆 bookinfo，请将浏览器反馈的结果 截图提交答题框。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[root@master samples]# cat bookinfo-gateway.yaml </span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: Gateway</span><br><span class="line">metadata:</span><br><span class="line">  name: bookinfo-gateway</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    istio: ingressgateway # use istio default controller</span><br><span class="line">  servers:</span><br><span class="line">  - port:</span><br><span class="line">      number: 80</span><br><span class="line">      name: http</span><br><span class="line">      protocol: HTTP</span><br><span class="line">    hosts:</span><br><span class="line">    - &quot;*&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: networking.istio.io/v1alpha3</span><br><span class="line">kind: VirtualService</span><br><span class="line">metadata:</span><br><span class="line">  name: bookinfo</span><br><span class="line">spec:</span><br><span class="line">  hosts:</span><br><span class="line">  - &quot;*&quot;</span><br><span class="line">  gateways:</span><br><span class="line">  - bookinfo-gateway</span><br><span class="line">  http:</span><br><span class="line">  - match:</span><br><span class="line">    - uri:</span><br><span class="line">        exact: /productpage</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /static</span><br><span class="line">    - uri:</span><br><span class="line">        exact: /login</span><br><span class="line">    - uri:</span><br><span class="line">        exact: /logout</span><br><span class="line">    - uri:</span><br><span class="line">        prefix: /api/v1/products</span><br><span class="line">    route:</span><br><span class="line">    - destination:</span><br><span class="line">        host: productpage</span><br><span class="line">        port:</span><br><span class="line">          number: 9080</span><br><span class="line">          </span><br><span class="line">kubectl apply -f bookinfo-gateway.yaml</span><br><span class="line"></span><br><span class="line">[root@k8s-master-node1 samples]# kubectl get gateways.networking.istio.io   </span><br><span class="line">NAME               AGE</span><br><span class="line">bookinfo-gateway   68s</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查询svc，找到对应端口，访问master:IP 端口/productpage即可</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\14009\AppData\Roaming\Typora\typora-user-images\image-20230318154213278.png" alt="image-20230318154213278"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="http://example.com">John Doe</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/">http://example.com/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/kubernetes/">kubernetes</a><a class="post-meta__tags" href="/tags/openstack/">openstack</a></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2022/05/26/628fa0426213d.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/05/09/hello-world/" title="Hello World"><img class="cover" src="https://bu.dusays.com/2022/05/26/628fa0426213d.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Hello World</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/touxiang.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">John Doe</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/shoit123"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="mailto:1400952418@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2022-%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97-%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98"><span class="toc-number">1.</span> <span class="toc-text">2022 年金砖国家职业技能大赛云计算_赛项样题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#A-%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE%EF%BC%9AOpenStack-%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-number">1.1.</span> <span class="toc-text">A 场次题目：OpenStack 平台部署与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-1-%E7%A7%81%E6%9C%89%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%885-%E5%88%86%EF%BC%89"><span class="toc-number">1.1.0.1.</span> <span class="toc-text">任务 1 私有云平台环境初始化（5 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.1.0.1.1.</span> <span class="toc-text">1.初始化操作系统</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%8C%82%E8%BD%BD%E5%AE%89%E8%A3%85%E5%85%89%E7%9B%98%E9%95%9C%E5%83%8F"><span class="toc-number">1.1.0.1.2.</span> <span class="toc-text">2.挂载安装光盘镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%90%AD%E5%BB%BA%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.0.1.3.</span> <span class="toc-text">3.搭建文件共享服务器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E8%AE%BE%E7%BD%AE-yum-%E6%BA%90"><span class="toc-number">1.1.0.1.4.</span> <span class="toc-text">4.设置 yum 源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E9%83%A8%E7%BD%B2%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.1.0.1.5.</span> <span class="toc-text">5.部署时间同步服务器</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-OpenStack-%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1%EF%BC%8810-%E5%88%86%EF%BC%89"><span class="toc-number">1.1.0.2.</span> <span class="toc-text">任务 2 OpenStack 搭建任务（10 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BF%AE%E6%94%B9%E5%8F%98%E9%87%8F%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.0.2.1.</span> <span class="toc-text">1.修改变量文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.0.2.2.</span> <span class="toc-text">2.搭建数据库组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%90%AD%E5%BB%BA%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.0.2.3.</span> <span class="toc-text">3.搭建认证服务组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%90%AD%E5%BB%BA%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.0.2.4.</span> <span class="toc-text">4.搭建镜像服务组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E6%90%AD%E5%BB%BA%E8%AE%A1%E7%AE%97%E6%9C%8D%E5%8A%A1%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.0.2.5.</span> <span class="toc-text">5.搭建计算服务组件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E6%90%AD%E5%BB%BA%E7%BD%91%E7%BB%9C%E7%BB%84%E4%BB%B6%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BD%91%E7%BB%9C"><span class="toc-number">1.1.0.2.6.</span> <span class="toc-text">6.搭建网络组件并初始化网络</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E6%90%AD%E5%BB%BA%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2"><span class="toc-number">1.1.0.2.7.</span> <span class="toc-text">7.搭建图形化界面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-OpenStack-%E8%BF%90%E7%BB%B4%E4%BB%BB%E5%8A%A1%EF%BC%8815-%E5%88%86%EF%BC%89"><span class="toc-number">1.1.0.3.</span> <span class="toc-text">任务 3 OpenStack 运维任务（15 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.1.</span> <span class="toc-text">1.用户管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.0.3.2.</span> <span class="toc-text">2.服务查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%95%9C%E5%83%8F%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.3.</span> <span class="toc-text">3.镜像管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.4.</span> <span class="toc-text">4.后端配置文件管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.5.</span> <span class="toc-text">5.存储服务管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E5%AD%98%E5%82%A8%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.6.</span> <span class="toc-text">6.存储服务管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E5%AE%89%E5%85%A8%E7%BB%84%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.7.</span> <span class="toc-text">8.安全组管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.8.</span> <span class="toc-text">9.网络管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.9.</span> <span class="toc-text">10.网络管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.0.3.10.</span> <span class="toc-text">11.虚拟机管理</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#B-%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE%EF%BC%9A%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BC%96%E6%8E%92%E4%B8%8E%E8%BF%90%E7%BB%B4"><span class="toc-number">1.2.</span> <span class="toc-text">B 场次题目：容器的编排与运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%8E%AF%E5%A2%83%E5%88%9D%E5%A7%8B%E5%8C%96%EF%BC%885-%E5%88%86%EF%BC%89"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">任务 1 容器云平台环境初始化（5 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%B9%E5%99%A8%E4%BA%91%E5%B9%B3%E5%8F%B0%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96-vim"><span class="toc-number">1.2.0.1.1.</span> <span class="toc-text">1.容器云平台的初始化 vim</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%8EYum-%E6%BA%90%E6%95%B0%E6%8D%AE%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96%E6%8C%82%E8%BD%BD"><span class="toc-number">1.2.0.1.2.</span> <span class="toc-text">2．Yum 源数据的持久化挂载</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%EF%BC%8EYum-%E6%BA%90%E7%9A%84%E7%BC%96%E5%86%99"><span class="toc-number">1.2.0.1.3.</span> <span class="toc-text">3．Yum 源的编写</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%EF%BC%8E%E8%AE%BE%E7%BD%AE%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">1.2.0.1.4.</span> <span class="toc-text">4．设置时间同步服务器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E8%AE%BE%E7%BD%AE%E5%85%8D%E5%AF%86%E7%99%BB%E5%BD%95"><span class="toc-number">1.2.0.1.5.</span> <span class="toc-text">5.设置免密登录</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-Kubernetes-%E6%90%AD%E5%BB%BA%E4%BB%BB%E5%8A%A1%EF%BC%8810-%E5%88%86%EF%BC%89"><span class="toc-number">1.2.0.2.</span> <span class="toc-text">任务 2 Kubernetes 搭建任务（10 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85-docker-%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.0.2.1.</span> <span class="toc-text">1.安装 docker 应用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%90%AD%E5%BB%BA-horbor-%E4%BB%93%E5%BA%93"><span class="toc-number">1.2.0.2.2.</span> <span class="toc-text">2.搭建 horbor 仓库</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%AE%89%E8%A3%85-docker-compose"><span class="toc-number">1.2.0.2.3.</span> <span class="toc-text">3.安装 docker-compose</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%B8%8A%E4%BC%A0-docker-%E9%95%9C%E5%83%8F"><span class="toc-number">1.2.0.2.4.</span> <span class="toc-text">4.上传 docker 镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E5%AE%89%E8%A3%85-kubeadm-%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.0.2.5.</span> <span class="toc-text">5.安装 kubeadm 工具</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9%E8%8E%B7%E5%8F%96%E5%BF%85%E5%A4%87%E9%95%9C%E5%83%8F"><span class="toc-number">1.2.0.2.6.</span> <span class="toc-text">6.计算节点获取必备镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-kubeadm-%E5%AE%89%E8%A3%85-master"><span class="toc-number">1.2.0.2.7.</span> <span class="toc-text">7.kubeadm 安装 master</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#8-%E5%AE%89%E8%A3%85-kubernetes"><span class="toc-number">1.2.0.2.8.</span> <span class="toc-text">8.安装 kubernetes</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#9-kubernetes-%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%95%8C%E9%9D%A2%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.0.2.9.</span> <span class="toc-text">9.kubernetes 图形化界面的安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#10-%E6%89%A9%E5%B1%95%E8%AE%A1%E7%AE%97%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.0.2.10.</span> <span class="toc-text">10.扩展计算节点</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-Kubernetes-%E8%BF%90%E7%BB%B4%E4%BB%BB%E5%8A%A1%EF%BC%8815-%E5%88%86%EF%BC%89"><span class="toc-number">1.2.0.3.</span> <span class="toc-text">任务 3 Kubernetes 运维任务（15 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8-dockerfile-%E6%9E%84%E5%BB%BA-dokcer-%E9%95%9C%E5%83%8F"><span class="toc-number">1.2.0.3.1.</span> <span class="toc-text">1.使用 dockerfile 构建 dokcer 镜像</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8"><span class="toc-number">1.2.0.3.2.</span> <span class="toc-text">2.持久化存储</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E7%BC%96%E5%86%99-deployment-%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.0.3.3.</span> <span class="toc-text">3.编写 deployment 文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E5%88%9B%E5%BB%BA-service-%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%8F%90%E4%BE%9B%E5%AF%B9%E5%A4%96%E8%AE%BF%E9%97%AE%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.0.3.4.</span> <span class="toc-text">4.创建 service 服务，提供对外访问接口</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE-metrics-server-%E5%AE%9E%E7%8E%B0%E8%B5%84%E6%BA%90%E7%9B%91%E6%8E%A7"><span class="toc-number">1.2.0.3.5.</span> <span class="toc-text">5.配置 metrics-server 实现资源监控</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-%E9%85%8D%E7%BD%AE%E5%BC%B9%E6%80%A7%E4%BC%B8%E7%BC%A9"><span class="toc-number">1.2.0.3.6.</span> <span class="toc-text">6.配置弹性伸缩</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#7-%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95"><span class="toc-number">1.2.0.3.7.</span> <span class="toc-text">7.压力测试</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E5%9C%BA%E6%AC%A1%E9%A2%98%E7%9B%AE%EF%BC%9A%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E5%92%8C%E8%BF%90%E7%BB%B4"><span class="toc-number">1.3.</span> <span class="toc-text">C 场次题目：企业级应用的自动化部署和运维</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-1-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%EF%BC%8815-%E5%88%86%EF%BC%89"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">任务 1 企业级应用的自动化部署（15 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.1.1.</span> <span class="toc-text">1.ansible 自动化运维工具的安装【3 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-ansible-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.1.2.</span> <span class="toc-text">2.ansible 自动化运维工具的初始化【3 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E4%B8%BB%E6%9C%BA%E6%B8%85%E5%8D%95%E7%9A%84%E7%BC%96%E5%86%99%E3%80%902-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.1.3.</span> <span class="toc-text">3.主机清单的编写【2 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E5%B7%A5%E5%85%B7%E5%AF%B9-master-%E8%8A%82%E7%82%B9%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E3%80%902-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.1.4.</span> <span class="toc-text">4.使用自动化工具对 master 节点进行初始化【2 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-%E4%BD%BF%E7%94%A8%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E5%AE%8C%E6%88%90%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E9%83%A8%E7%BD%B2%E3%80%905-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.1.5.</span> <span class="toc-text">5.使用自动化运维工具完成企业级应用的部署【5 分】</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BA%94%E7%94%A8%E7%9A%84%E8%BF%90%E7%BB%B4%EF%BC%8812-%E5%88%86%EF%BC%89"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">任务 2 企业级应用的运维（12 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E4%BD%BF%E7%94%A8-prometheus-%E7%9B%91%E6%8E%A7-mysqld-%E6%9C%8D%E5%8A%A1%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.2.1.</span> <span class="toc-text">1.使用 prometheus 监控 mysqld 服务【3 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85-alertmanager-%E6%8A%A5%E8%AD%A6%E7%BB%84%E4%BB%B6%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.2.2.</span> <span class="toc-text">2.安装 alertmanager 报警组件【3 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-alertmanager-%E5%91%8A%E8%AD%A6%E9%82%AE%E4%BB%B6%E6%96%87%E4%BB%B6%E7%BC%96%E5%86%99%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.2.3.</span> <span class="toc-text">3.alertmanager 告警邮件文件编写【3 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-alertmanager-%E5%91%8A%E8%AD%A6%E8%A7%84%E5%88%99%E7%BC%96%E5%86%99%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.3.0.2.4.</span> <span class="toc-text">4.alertmanager 告警规则编写【3 分】</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%BE%AE%E6%9C%8D%E5%8A%A1%E8%BF%90%E7%BB%B4%EF%BC%8813-%E5%88%86%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">任务 3 企业级微服务运维（13 分）</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%9C%A8-Kubernetes-%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85-istio%E3%80%904-%E5%88%86%E3%80%91"><span class="toc-number">1.4.0.0.1.</span> <span class="toc-text">1.在 Kubernetes 集群安装 istio【4 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%83%A8%E7%BD%B2%E5%9F%BA%E4%BA%8E%E5%9C%A8%E7%BA%BF%E4%B9%A6%E5%BA%97-bookinfo%E3%80%906-%E5%88%86%E3%80%91"><span class="toc-number">1.4.0.0.2.</span> <span class="toc-text">2.部署基于在线书店 bookinfo【6 分】</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E9%83%A8%E7%BD%B2%E7%BD%91%E5%85%B3%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E5%AF%B9%E5%A4%96%E6%9C%8D%E5%8A%A1%E3%80%903-%E5%88%86%E3%80%91"><span class="toc-number">1.4.0.0.3.</span> <span class="toc-text">3.部署网关接口实现对外服务【3 分】</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/" title="2022年金砖国家职业技能大赛云计算赛项样题详解"><img src="https://bu.dusays.com/2022/05/26/628fa0426213d.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022年金砖国家职业技能大赛云计算赛项样题详解"/></a><div class="content"><a class="title" href="/2023/05/09/2022%E5%B9%B4%E9%87%91%E7%A0%96%E5%9B%BD%E5%AE%B6%E8%81%8C%E4%B8%9A%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E4%BA%91%E8%AE%A1%E7%AE%97%E8%B5%9B%E9%A1%B9%E6%A0%B7%E9%A2%98%E8%AF%A6%E8%A7%A3/" title="2022年金砖国家职业技能大赛云计算赛项样题详解">2022年金砖国家职业技能大赛云计算赛项样题详解</a><time datetime="2023-05-09T08:01:58.000Z" title="Created 2023-05-09 16:01:58">2023-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/05/09/hello-world/" title="Hello World"><img src="https://bu.dusays.com/2022/05/26/628fa0426213d.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hello World"/></a><div class="content"><a class="title" href="/2023/05/09/hello-world/" title="Hello World">Hello World</a><time datetime="2023-05-09T06:50:56.696Z" title="Created 2023-05-09 14:50:56">2023-05-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 By John Doe</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script src="/js/sakura.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>